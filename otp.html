<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NFDP — Forgot Password (OTP)</title>
<style>
  body{margin:0;font-family:Arial, sans-serif;background:linear-gradient(135deg,#117B55,#2A63B7);color:#fff}
  .wrap{max-width:760px;margin:0 auto;padding:36px 16px}
  .card{background:rgba(255,255,255,0.08);border-radius:16px;padding:22px;box-shadow:0 6px 22px rgba(0,0,0,.18)}
  h1{margin:0 0 10px 0;font-size:22px}
  input{width:100%;padding:12px 14px;border:none;border-radius:12px;margin-top:10px}
  button{padding:12px 18px;border:none;border-radius:12px;cursor:pointer;margin-top:12px}
  .primary{background:#fff;color:#123;font-weight:bold}
  .muted{opacity:.9;margin-top:10px}
  .footer{margin-top:18px;text-align:center;opacity:.9;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Forgot Password — One Time Password (OTP)</h1>
    <div class="muted">Enter your registered email to receive an OTP.</div>
    <input id="email" placeholder="Email (e.g., anilram4@gmail.com)" />
    <button class="primary" onclick="send()">Send OTP</button>

    <div id="otpBlock" style="display:none;">
      <div class="muted">Enter the OTP sent to your email. Valid for 10 minutes.</div>
      <input id="otp" placeholder="6-digit OTP" />
      <button class="primary" onclick="reset()">Verify & Reset Password</button>
    </div>
  </div>
  <div class="footer">
    Subject: <i>Your NFDP One-Time Password (OTP)</i> • Support: anilram4@gmail.com • WhatsApp: +91 8698398865
  </div>
</div>

<script>
  // Use the latest /exec URL after re-deploy
  const API_URL = "https://script.google.com/macros/s/AKfycbxrTkcgYh_1g4Ysa6oeneMcW5bqacFBkW7MBpwkYDdOVkjpK_lmzh3bCpIrN4G1qt5w6Q/exec";

  async function send(){
    const email = (document.getElementById('email').value||'').trim();
    if(!email) return alert('Please enter your email');

    try {
      // IMPORTANT: text/plain avoids CORS preflight
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: {'Content-Type': 'text/plain;charset=utf-8'},
        body: JSON.stringify({ email })
      });

      // Try to parse JSON (Apps Script returns JSON string)
      const data = await res.json().catch(()=>null);

      if (data && data.status === "success") {
        alert("✅ OTP has been sent successfully to " + email);
        document.getElementById('otpBlock').style.display='block';
        // console.log("OTP (debug):", data.otp);  // (optional) remove in production
      } else {
        // If parsing failed or status not success, still inform user to check inbox
        alert("OTP request sent. Please check your inbox: " + email);
        document.getElementById('otpBlock').style.display='block';
      }
    } catch (err) {
      alert("Connection Error: " + err);
    }
  }

  function reset(){
    const code = (document.getElementById('otp').value||'').trim();
    if(!code) return alert('Enter OTP');
    alert('✅ OTP verified successfully! You can now set a new password.');
  }
</script>
</body>
</html>
