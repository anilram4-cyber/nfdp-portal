<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NFDP — Forgot Password (OTP)</title>
<style>
  body{margin:0;font-family:Arial, sans-serif;background:linear-gradient(135deg,#117B55,#2A63B7);color:#fff}
  .wrap{max-width:760px;margin:0 auto;padding:36px 16px}
  .card{background:rgba(255,255,255,0.08);border-radius:16px;padding:22px;box-shadow:0 6px 22px rgba(0,0,0,.18)}
  h1{margin:0 0 10px 0;font-size:22px}
  input{width:100%;padding:12px 14px;border:none;border-radius:12px;margin-top:10px}
  button{padding:12px 18px;border:none;border-radius:12px;cursor:pointer;margin-top:12px}
  .primary{background:#fff;color:#123;font-weight:bold}
  .muted{opacity:.9;margin-top:10px}
  .footer{margin-top:18px;text-align:center;opacity:.9;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Forgot Password — One Time Password (OTP)</h1>
    <input id="email" placeholder="Email (e.g., anilram4@gmail.com)" />
    <button class="primary" onclick="send()">Send OTP</button>

    <div id="otpBlock" style="display:none;">
      <div class="muted">Enter the OTP sent to your email.</div>
      <input id="otp" placeholder="6-digit OTP" />
      <button class="primary" onclick="verify()">Verify OTP</button>
    </div>

    <div id="resetBlock" style="display:none;">
      <div class="muted">Enter a new password</div>
      <input id="newpass" placeholder="New password" type="password" />
      <button class="primary" onclick="reset()">Reset Password</button>
    </div>
  </div>
  <div class="footer">
    NFDP Cloud Portal • Support: anilram4@gmail.com • WhatsApp: +91 8698398865
  </div>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbw91t2oj-45KOiJyveqFdqjiahwhM_P35isO-ztUVHFmG1TL7GPeCKcH4FzHVHQZUd2mQ/exec";

  async function send(){
    const email = get("email").trim();
    if(!email) return alert("Please enter your email");
    await fetch(API_URL, {
      method:"POST", headers:{'Content-Type':'text/plain'},
      body: JSON.stringify({ email })
    });
    alert("✅ OTP sent! Please check your inbox.");
    show("otpBlock");
  }

  async function verify(){
    const email = get("email").trim();
    const otp = get("otp").trim();
    if(!otp) return alert("Enter OTP");
    const res = await fetch(API_URL, {
      method:"POST", headers:{'Content-Type':'text/plain'},
      body: JSON.stringify({ email, otp })
    });
    const d = await res.json();
    if(d.status === "verified"){
      alert("✅ OTP verified!");
      hide("otpBlock"); show("resetBlock");
    } else {
      alert("❌ " + d.message);
    }
  }

  async function reset(){
    const email = get("email").trim();
    const otp = get("otp").trim();
    const newPassword = get("newpass").trim();
    if(!newPassword) return alert("Enter new password");
    const res = await fetch(API_URL, {
      method:"POST", headers:{'Content-Type':'text/plain'},
      body: JSON.stringify({ email, otp, newPassword })
    });
    const d = await res.json();
    if(d.status === "reset"){
      alert("🎉 Password reset successfully!");
      window.location.href = "index.html";
    } else {
      alert("❌ " + d.message);
    }
  }

  // Helper
  const get = id => document.getElementById(id).value;
  const show = id => document.getElementById(id).style.display = 'block';
  const hide = id => document.getElementById(id).style.display = 'none';
</script>
</body>
</html>
