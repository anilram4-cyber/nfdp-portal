<script>
  // Put your NEW /exec URL here
  const API_URL = "https://script.google.com/macros/s/AKfycbw91t2oj-45KOiJyveqFdqjiahwhM_P35isO-ztUVHFmG1TL7GPeCKcH4FzHVHQZUd2mQ/exec";

  function norm(s){ return (s||"").trim().toLowerCase(); }

  async function send(){
    const email = norm(document.getElementById('email').value);
    if(!email) return alert('Please enter your email');

    // Use text/plain to avoid preflight
    await fetch(API_URL, {
      method: 'POST',
      headers: {'Content-Type': 'text/plain;charset=utf-8'},
      body: JSON.stringify({ email })
    });

    alert("‚úÖ OTP sent! Please check your inbox.");
    document.getElementById('otpBlock').style.display='block';
  }

  async function verify(){
    const email = norm(document.getElementById('email').value);
    const otp = (document.getElementById('otp').value||"").trim();
    if(!otp) return alert("Enter OTP");

    const res = await fetch(API_URL, {
      method:'POST',
      headers:{'Content-Type':'text/plain;charset=utf-8'},
      body: JSON.stringify({ email, otp })
    });
    const d = await res.json();

    if(d.status === "verified"){
      alert("‚úÖ OTP verified successfully!");
      document.getElementById('otpBlock').style.display='none';
      document.getElementById('resetBlock').style.display='block';
    } else if (d.status === "expired") {
      alert("‚è∞ OTP expired. Please resend.");
    } else if (d.status === "invalid") {
      alert("‚ùå Wrong OTP");
    } else if (d.status === "notfound") {
      alert("‚ùå No OTP found for this email. Please send OTP again.");
    } else {
      alert("‚ùå " + (d.message || "Verification failed"));
    }
  }

  async function reset(){
    const email = norm(document.getElementById('email').value);
    const otp = (document.getElementById('otp').value||"").trim();
    const newPassword = (document.getElementById('newpass').value||"").trim();
    if(!newPassword) return alert("Enter new password");

    const res = await fetch(API_URL, {
      method:'POST',
      headers:{'Content-Type':'text/plain;charset=utf-8'},
      body: JSON.stringify({ email, otp, newPassword })
    });
    const d = await res.json();
    if(d.status === "reset"){
      alert("üéâ Password reset successfully!");
      window.location.href = "index.html";
    } else {
      alert("‚ùå " + (d.message || "Reset failed"));
    }
  }
</script>
